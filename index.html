<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Dynamique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom animation for results */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-reveal { animation: slideIn 0.4s ease-out forwards; }
        
        /* Glassmorphism subtle effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col items-center justify-center p-4 sm:p-8 text-slate-900">

    <div id="quiz-container" class="w-full max-w-lg glass-card rounded-[2rem] shadow-xl shadow-slate-200/50 overflow-hidden">
        
        <div class="h-2 w-full bg-slate-100">
            <div id="progress-bar" class="h-full bg-indigo-500 transition-all duration-700" style="width: 0%"></div>
        </div>

        <div class="p-6 sm:p-10">
            <div id="loading" class="flex flex-col items-center py-12 space-y-4">
                <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"></div>
                <p class="text-slate-400 italic animate-pulse">Pr√©paration de votre d√©fi...</p>
            </div>
            
            <div id="quiz-content" class="hidden">
                <span class="inline-block px-3 py-1 rounded-full bg-indigo-50 text-indigo-600 text-xs font-bold uppercase tracking-wider mb-4">
                    Question du jour
                </span>
                
                <h1 id="question" class="text-2xl font-extrabold text-slate-800 leading-tight mb-8"></h1>
                
                <form id="quiz-form" class="space-y-4">
                    <div id="options-container" class="space-y-3">
                        </div>
                    
                    <button type="submit" id="submit-btn" 
                        class="w-full bg-slate-900 hover:bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg hover:shadow-indigo-200 transition-all active:scale-[0.98] mt-6">
                        Confirmer ma r√©ponse
                    </button>
                </form>

                <div id="result" class="hidden mt-8 p-6 rounded-2xl animate-reveal border-2">
                    <div class="flex items-center space-x-3 mb-2">
                        <span id="result-icon" class="text-2xl"></span>
                        <p id="result-text" class="text-lg font-bold"></p>
                    </div>
                    <p id="explanation" class="text-slate-600 leading-relaxed text-sm"></p>
                </div>
            </div>
        </div>
    </div>

    <div class="w-full max-w-lg px-4 mt-6">
        <button onclick="window.location.href=window.location.pathname" 
            class="group w-full py-4 text-sm font-semibold text-slate-500 bg-white border border-slate-200 rounded-2xl hover:text-indigo-600 hover:border-indigo-200 hover:shadow-md transition-all flex items-center justify-center gap-3">
            <span class="group-hover:rotate-180 transition-transform duration-500">üîÑ</span>
            Tirer une autre question al√©atoire
        </button>
        <p class="text-center mt-4 text-slate-400 text-xs tracking-tight">
            Propuls√© par Google Sheets & GitHub Pages
        </p>
    </div>

    <script>
    // 1. CONFIGURATION: Your Published Web App URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxS1AiF9YIkNRtx6jNEHktZlTURrjbkxREgqj1v2CYc7mynfqHw0hgYXdoC-m1I1cAv2A/exec";

  async function loadQuestion() {
    const urlParams = new URLSearchParams(window.location.search);
    let questionId = urlParams.get('id');

    // --- NEW RANDOMIZER LOGIC ---
    if (!questionId) {
        // Define your range (e.g., from row 2 to 5)
        const minRow = 2;
        const maxRow = 5; // Update this number as you add rows
        const randomId = Math.floor(Math.random() * (maxRow - minRow + 1)) + minRow;
        
        console.log("No ID found. Redirecting to random ID:", randomId);
        
        // Reload the page with the new ID
        window.location.search = `?id=${randomId}`;
        return; // Stop execution here, the page will reload
    }
    // --- END OF RANDOMIZER ---

    console.log("Targeting Question ID:", questionId);
    document.getElementById('loading').textContent = `Chargement de la question ${questionId}...`;

    try {
        const fetchUrl = `${SCRIPT_URL}?id=${questionId}&nocache=${new Date().getTime()}`;
        const response = await fetch(fetchUrl);
        const data = await response.json();
        renderQuiz(data);
    } catch (err) {
        console.error("Error:", err);
    }
}

    function renderQuiz(data) {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('quiz-content').classList.remove('hidden');
        document.getElementById('question').textContent = data.question;

        const container = document.getElementById('options-container');
        container.innerHTML = ""; // Clear any previous content

        data.choix.forEach((text, index) => {
            const div = document.createElement('div');
            div.innerHTML = `
                <input type="radio" name="answer" id="opt${index}" value="${index}" class="hidden peer" required>
                <label for="opt${index}" class="flex items-center p-3 border rounded-lg cursor-pointer peer-checked:border-blue-500 peer-checked:bg-blue-50 hover:bg-gray-50 transition-all text-sm">
                    <span class="mr-2 opacity-50 font-mono">${String.fromCharCode(65 + index)}.</span>
                    ${text}
                </label>
            `;
            container.appendChild(div);
        });

        document.getElementById('quiz-form').onsubmit = (e) => {
            e.preventDefault();
            const userAns = parseInt(new FormData(e.target).get('answer'));
            const isCorrect = userAns === data.reponse_correcte;
            
            console.log("Submission:", { userAns, correctAns: data.reponse_correcte, result: isCorrect });

            const resDiv = document.getElementById('result');
            resDiv.classList.remove('hidden');
            resDiv.className = isCorrect ? "mt-5 p-4 rounded-xl bg-green-50 border border-green-200" : "mt-5 p-4 rounded-xl bg-red-50 border border-red-200";
            
            document.getElementById('result-text').textContent = isCorrect ? "‚úÖ Bravo !" : "‚ùå Incorrect";
            document.getElementById('result-text').className = isCorrect ? "font-bold text-green-800" : "font-bold text-red-800";
            
            // Explanation logic: handles both nested objects and simple strings
            const exp = data.explication;
            const explanationText = isCorrect ? 
                (exp.explication_succes || exp) : 
                (exp.explication_erreur || exp);
            
            document.getElementById('explanation').textContent = explanationText;
            document.getElementById('submit-btn').classList.add('hidden');
        };
    }

    loadQuestion();
</script>
</body>
</html>
