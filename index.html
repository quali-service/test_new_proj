<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Quiz & Collecte</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-reveal { animation: slideIn 0.4s ease-out forwards; }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(226, 232, 240, 0.8);
        }

        /* Active Nav Styling */
        .nav-active {
            background-color: #4f46e5; /* indigo-600 */
            color: white !important;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen text-slate-900 font-sans">

    <nav class="fixed bottom-0 left-0 w-full bg-white border-t border-slate-200 z-50 lg:top-0 lg:left-0 lg:w-64 lg:h-full lg:border-t-0 lg:border-r flex lg:flex-col justify-around lg:justify-start p-2 lg:p-6 space-y-0 lg:space-y-4">
        <div class="hidden lg:block mb-8 px-2">
            <h2 class="text-xl font-black text-indigo-600 tracking-tighter">QUIZ APP</h2>
            <p class="text-xs text-slate-400">Knowledge Manager v1.0</p>
        </div>

        <button onclick="showSection('form-section')" id="nav-form" class="flex flex-col lg:flex-row items-center gap-1 lg:gap-3 px-4 py-2 lg:py-3 rounded-2xl text-slate-500 hover:bg-slate-50 transition-all w-full text-sm font-bold">
            <span class="text-xl">üìù</span>
            <span>Formulaire</span>
        </button>

        <button onclick="showSection('quiz-section')" id="nav-quiz" class="nav-active flex flex-col lg:flex-row items-center gap-1 lg:gap-3 px-4 py-2 lg:py-3 rounded-2xl text-slate-500 hover:bg-slate-50 transition-all w-full text-sm font-bold">
            <span class="text-xl">üß†</span>
            <span>Question</span>
        </button>
    </nav>

    <main class="lg:ml-64 p-4 pb-24 lg:pb-8 min-h-screen flex items-center justify-center">
        
        <div id="form-section" class="hidden w-full max-w-3xl animate-reveal">
            <div class="glass-card rounded-[2rem] shadow-xl p-6 min-h-[500px] flex flex-col items-center justify-center">
                <h2 class="text-2xl font-bold mb-6">Ajouter une Question</h2>
                <iframe src="YOUR_GOOGLE_FORM_URL_HERE" width="100%" height="600" frameborder="0" marginheight="0" marginwidth="0" class="rounded-xl border border-slate-100">Chargement‚Ä¶</iframe>
            </div>
        </div>

        <div id="quiz-section" class="w-full max-w-lg animate-reveal">
            <div id="quiz-container" class="glass-card rounded-[2rem] shadow-xl shadow-slate-200/50 overflow-hidden">
                <div class="h-2 w-full bg-slate-100">
                    <div id="progress-bar" class="h-full bg-indigo-500 transition-all duration-700" style="width: 0%"></div>
                </div>

                <div class="p-6 sm:p-10">
                    <div id="loading" class="flex flex-col items-center py-12 space-y-4">
                        <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-indigo-600"></div>
                        <p class="text-slate-400 italic animate-pulse">Chargement du d√©fi...</p>
                    </div>
                    
                    <div id="quiz-content" class="hidden">
                        <span class="inline-block px-3 py-1 rounded-full bg-indigo-50 text-indigo-600 text-xs font-bold uppercase tracking-wider mb-4">Question Al√©atoire</span>
                        <h1 id="question" class="text-2xl font-extrabold text-slate-800 leading-tight mb-8"></h1>
                        <form id="quiz-form" class="space-y-4">
                            <div id="options-container" class="space-y-3"></div>
                            <button type="submit" id="submit-btn" class="w-full bg-slate-900 hover:bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg transition-all active:scale-[0.98] mt-6">Valider la r√©ponse</button>
                        </form>

                        <div id="result" class="hidden mt-8 p-6 rounded-2xl animate-reveal border-2">
                            <div class="flex items-center space-x-3 mb-2">
                                <span id="result-icon" class="text-2xl"></span>
                                <p id="result-text" class="text-lg font-bold"></p>
                            </div>
                            <p id="explanation" class="text-slate-600 leading-relaxed text-sm"></p>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="window.location.href=window.location.pathname" 
                class="group w-full py-4 mt-6 text-sm font-semibold text-slate-500 bg-white border border-slate-200 rounded-2xl hover:text-indigo-600 transition-all flex items-center justify-center gap-3">
                <span>üîÑ</span> Tirer une autre question
            </button>
        </div>
    </main>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxS1AiF9YIkNRtx6jNEHktZlTURrjbkxREgqj1v2CYc7mynfqHw0hgYXdoC-m1I1cAv2A/exec";

        // TAB NAVIGATION LOGIC
        function showSection(sectionId) {
            document.getElementById('form-section').classList.add('hidden');
            document.getElementById('quiz-section').classList.add('hidden');
            document.getElementById(sectionId).classList.remove('hidden');

            // Update Nav UI
            document.getElementById('nav-form').classList.remove('nav-active');
            document.getElementById('nav-quiz').classList.remove('nav-active');
            
            if(sectionId === 'form-section') document.getElementById('nav-form').classList.add('nav-active');
            else document.getElementById('nav-quiz').classList.add('nav-active');
        }

        async function loadQuestion() {
            const urlParams = new URLSearchParams(window.location.search);
            let questionId = urlParams.get('id');

            if (!questionId) {
                try {
                    const res = await fetch(`${SCRIPT_URL}?action=getMax`);
                    const data = await res.json();
                    const maxRow = data.max || 5;
                    const randomId = Math.floor(Math.random() * (maxRow - 2 + 1)) + 2;
                    window.location.search = `?id=${randomId}`;
                    return;
                } catch (e) {
                    window.location.search = `?id=2`;
                    return;
                }
            }

            try {
                const response = await fetch(`${SCRIPT_URL}?id=${questionId}&cache=${Date.now()}`);
                const data = await response.json();
                renderQuiz(data);
                document.getElementById('progress-bar').style.width = '100%';
            } catch (err) {
                document.getElementById('loading').innerHTML = `<p class="text-red-500">Erreur de chargement</p>`;
            }
        }

        function renderQuiz(data) {
            document.getElementById('loading').classList.add('hidden');
            const content = document.getElementById('quiz-content');
            content.classList.remove('hidden');
            document.getElementById('question').textContent = data.question;
            const container = document.getElementById('options-container');
            container.innerHTML = "";

            data.choix.forEach((text, index) => {
                const label = document.createElement('label');
                label.className = "flex items-center p-4 border-2 border-slate-100 rounded-2xl cursor-pointer hover:border-indigo-200 transition-all";
                label.innerHTML = `
                    <input type="radio" name="answer" value="${index}" class="hidden peer" required>
                    <div class="w-6 h-6 border-2 border-slate-300 rounded-full flex items-center justify-center peer-checked:border-indigo-500 peer-checked:bg-indigo-500 transition-all mr-4">
                        <div class="w-2 h-2 bg-white rounded-full scale-0 peer-checked:scale-100 transition-transform"></div>
                    </div>
                    <span class="text-slate-700 font-medium">${text}</span>
                `;
                container.appendChild(label);
            });

            document.getElementById('quiz-form').onsubmit = (e) => {
                e.preventDefault();
                const userAns = parseInt(new FormData(e.target).get('answer'));
                const isCorrect = userAns === data.reponse_correcte;
                const resDiv = document.getElementById('result');
                resDiv.classList.remove('hidden');
                resDiv.className = isCorrect ? "mt-8 p-6 rounded-2xl bg-emerald-50 border-emerald-100 animate-reveal" : "mt-8 p-6 rounded-2xl bg-rose-50 border-rose-100 animate-reveal";
                document.getElementById('result-icon').textContent = isCorrect ? "‚ú®" : "üßê";
                document.getElementById('result-text').textContent = isCorrect ? "Bravo !" : "Presque...";
                document.getElementById('explanation').textContent = isCorrect ? (data.explication.explication_succes || data.explication) : (data.explication.explication_erreur || data.explication);
                document.getElementById('submit-btn').classList.add('hidden');
            };
        }

        loadQuestion();
    </script>
</body>
</html>
