<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white">
    <div id="quiz-container" class="max-w-md mx-auto p-4 border rounded-2xl shadow-sm">
        <div id="loading" class="text-center py-10 text-gray-500 italic">Initialisation...</div>
        
        <div id="quiz-content" class="hidden">
            <h1 id="question" class="text-xl font-bold text-gray-900 mb-5"></h1>
            <form id="quiz-form" class="space-y-3">
                <div id="options-container" class="space-y-2"></div>
                <button type="submit" id="submit-btn" class="w-full bg-black text-white py-3 rounded-xl mt-4">Valider</button>
            </form>
            <div id="result" class="hidden mt-5 p-4 rounded-xl border">
                <p id="result-text" class="font-bold"></p>
                <p id="explanation" class="text-sm mt-1"></p>
            </div>
            
        </div>
    <div class="max-w-md mx-auto px-4">
        <button onclick="window.location.href=window.location.pathname" 
                class="mt-4 w-full py-3 text-sm font-medium text-gray-500 bg-gray-50 border border-gray-200 rounded-xl hover:bg-gray-100 active:bg-gray-200 transition-all flex items-center justify-center gap-2">
            üîÑ Tirer une autre question
        </button>
    </div>

    <script>
    // 1. CONFIGURATION: Your Published Web App URL
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxS1AiF9YIkNRtx6jNEHktZlTURrjbkxREgqj1v2CYc7mynfqHw0hgYXdoC-m1I1cAv2A/exec";

  async function loadQuestion() {
    const urlParams = new URLSearchParams(window.location.search);
    let questionId = urlParams.get('id');

    // --- NEW RANDOMIZER LOGIC ---
    if (!questionId) {
        // Define your range (e.g., from row 2 to 5)
        const minRow = 2;
        const maxRow = 5; // Update this number as you add rows
        const randomId = Math.floor(Math.random() * (maxRow - minRow + 1)) + minRow;
        
        console.log("No ID found. Redirecting to random ID:", randomId);
        
        // Reload the page with the new ID
        window.location.search = `?id=${randomId}`;
        return; // Stop execution here, the page will reload
    }
    // --- END OF RANDOMIZER ---

    console.log("Targeting Question ID:", questionId);
    document.getElementById('loading').textContent = `Chargement de la question ${questionId}...`;

    try {
        const fetchUrl = `${SCRIPT_URL}?id=${questionId}&nocache=${new Date().getTime()}`;
        const response = await fetch(fetchUrl);
        const data = await response.json();
        renderQuiz(data);
    } catch (err) {
        console.error("Error:", err);
    }
}

    function renderQuiz(data) {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('quiz-content').classList.remove('hidden');
        document.getElementById('question').textContent = data.question;

        const container = document.getElementById('options-container');
        container.innerHTML = ""; // Clear any previous content

        data.choix.forEach((text, index) => {
            const div = document.createElement('div');
            div.innerHTML = `
                <input type="radio" name="answer" id="opt${index}" value="${index}" class="hidden peer" required>
                <label for="opt${index}" class="flex items-center p-3 border rounded-lg cursor-pointer peer-checked:border-blue-500 peer-checked:bg-blue-50 hover:bg-gray-50 transition-all text-sm">
                    <span class="mr-2 opacity-50 font-mono">${String.fromCharCode(65 + index)}.</span>
                    ${text}
                </label>
            `;
            container.appendChild(div);
        });

        document.getElementById('quiz-form').onsubmit = (e) => {
            e.preventDefault();
            const userAns = parseInt(new FormData(e.target).get('answer'));
            const isCorrect = userAns === data.reponse_correcte;
            
            console.log("Submission:", { userAns, correctAns: data.reponse_correcte, result: isCorrect });

            const resDiv = document.getElementById('result');
            resDiv.classList.remove('hidden');
            resDiv.className = isCorrect ? "mt-5 p-4 rounded-xl bg-green-50 border border-green-200" : "mt-5 p-4 rounded-xl bg-red-50 border border-red-200";
            
            document.getElementById('result-text').textContent = isCorrect ? "‚úÖ Bravo !" : "‚ùå Incorrect";
            document.getElementById('result-text').className = isCorrect ? "font-bold text-green-800" : "font-bold text-red-800";
            
            // Explanation logic: handles both nested objects and simple strings
            const exp = data.explication;
            const explanationText = isCorrect ? 
                (exp.explication_succes || exp) : 
                (exp.explication_erreur || exp);
            
            document.getElementById('explanation').textContent = explanationText;
            document.getElementById('submit-btn').classList.add('hidden');
        };
    }

    loadQuestion();
</script>
</body>
</html>
